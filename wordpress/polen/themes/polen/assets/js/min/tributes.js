const btn_play=document.getElementById("btn-play"),video_tribute=document.getElementById("tribute-home-video"),formCreateName="form#form-create-tribute",formCreate=document.querySelector(formCreateName),slug=document.getElementById("slug"),nameInput=document.getElementById("name_honored"),formsResend=document.querySelectorAll(".resend-email"),SESSION_OBJ_INVITES="polen_tributes_invites";function playVideo(e){video_tribute.paused?(btn_play.classList.add("hidden"),video_tribute.play()):(btn_play.classList.remove("hidden"),video_tribute.pause())}function slugValidate(e,t){const n=document.getElementById("slug-message");slug.classList.remove("error"),n.classList.remove("error"),n.innerText="",e||(slug.classList.add("error"),n.classList.add("error")),n.innerText=t}function getSlug(){slug.value||(slug.value=polSlugfy(nameInput.value),checkSlug())}function mascaraData(e,t){var n=document.all?event.keyCode:t.keyCode,s=e.value;8!=n&&46!=n&&(2==s.length||5==s.length?e.value=s+="/":e.value=s)}function checkSlug(){polSpinner(CONSTANTS.SHOW,".slug-wrap"),jQuery.ajax({type:"POST",url:polenObj.ajax_url,data:{action:"check_tribute_slug_exists",slug:slug.value},success:function(e){e.success?slugValidate(!0,e.data):slugValidate(!1,e.data)},error:function(e,t,n){slugValidate(!1,e.responseJSON.data)},complete:function(){polSpinner(CONSTANTS.HIDDEN)}})}function createTribute(e){e.preventDefault(),slug.classList.contains("error")?polError("É preciso uma URL válida para seu Tributo"):(polSpinner(),jQuery.post(polenObj.ajax_url,jQuery(formCreateName).serialize(),(function(e){e.success?(setSessionMessage(CONSTANTS.SUCCESS,"Tributo criado","Agora convide seus amigos para essa homenagem"),window.location.href=e.data.url_redirect):polError(e.data)})).fail((function(e){polSpinner(CONSTANTS.HIDDEN),e.responseJSON?polError(e.responseJSON.data):polError(e.statusText)})))}function reSendEmail(e){e.preventDefault(),polAjaxForm("form#"+e.target.id,(function(){polMessage("Enviado","e-mail foi enviado com sucesso")}),(function(e){polError(e)}))}if(btn_play&&btn_play.addEventListener("click",playVideo),slug&&(slug.addEventListener("focusout",checkSlug),nameInput.addEventListener("focusout",getSlug)),formCreate&&formCreate.addEventListener("submit",createTribute),formsResend.length&&formsResend.forEach((function(e){e.addEventListener("submit",reSendEmail)})),document.getElementById("invite-friends")){function saveToDisk(e){sessionStorage.setItem(SESSION_OBJ_INVITES,JSON.stringify(e))}function getToDisk(){const e=sessionStorage.getItem(SESSION_OBJ_INVITES);return e?JSON.parse(e):[]}function submitFriends(e){polAjaxForm("form#friends-form",(function(){sessionStorage.removeItem(SESSION_OBJ_INVITES),polMessage("Amigos adicionados com sucesso","Seus amigos receberão as instruções por e-mail"),e.friends=[]}),(function(e){polError(e)}))}new Vue({el:"#invite-friends",data:{name:"",email:"",friends:getToDisk()},methods:{resetAddFriend:function(){this.name=this.email=""},updateDisk:function(){saveToDisk(this.friends)},addFriend:function(){this.friends.push({name:this.name,email:this.email}),this.resetAddFriend(),this.updateDisk(),document.getElementById("add-name").focus()},removeFriend:function(e){this.friends=this.friends.filter(t=>t.email!=e),this.updateDisk()},onChangeEmail:function(e){"Enter"==e.key&&this.addFriend()},sendFriends:function(){submitFriends(this)}}})}